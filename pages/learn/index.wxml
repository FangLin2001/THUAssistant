<!--pages/learn/index.wxml-->

<wxs module="fn">
  module.exports = {
    indexOf: function (arr, id) {
      return arr.indexOf(id);
    }
  }
</wxs>

<view>
  <van-tabs active="{{ active }}" bind:change="onChange" swipeable animated sticky color="#9932CC">
    <van-tab wx:for="{{ tabDatas }}" wx:key="index" title="{{item.text}}">
      <!-- 公告 -->
      <view hidden="{{active != 0}}">
        <van-cell-group>
          <view wx:for="{{notifications}}" wx:key="id" wx:for-item="notification" style="touch-action: none;">
            <block wx:if="{{fn.indexOf(discardNotifications, notification.id) == -1}}">
              <block wx:if="{{notification.hasRead}}">
                <van-swipe-cell right-width="{{ 60 }}" data-id="{{notification.id}}" bind:click="notiToTap" data-noti="{{notification}}">
                  <view slot="right">
                    <view class="van-swipe-cell__right">归档</view>
                  </view>
                  <van-cell inset use-label-slot="true" clickable="true">
                    <view slot="title">
                      <view>{{notification.title}}</view>
                    </view>
                    <view slot="label">
                      <view class="van-multi-ellipsis--l2">
                        <rich-text nodes="{{notification.content}}"></rich-text>
                      </view>
                    </view>
                  </van-cell>
                </van-swipe-cell>
              </block>
              <block wx:if="{{!notification.hasRead}}">
                <van-swipe-cell right-width="{{ 60 }}" data-id="{{notification.id}}" bind:click="notiToTap" data-noti="{{notification}}">
                  <view slot="right">
                    <view class="van-swipe-cell__right">归档</view>
                  </view>
                  <van-cell inset use-label-slot="true" clickable="true">
                    <view slot="title">
                      <view>{{notification.title}} <van-tag color="#9932CC" plain>未读</van-tag>
                      </view>
                    </view>
                    <view slot="label">
                      <view class="van-multi-ellipsis--l2">
                        <rich-text nodes="{{notification.content}}"></rich-text>
                      </view>
                    </view>
                  </van-cell>
                </van-swipe-cell>
              </block>
            </block>
          </view>
          <van-cell inset is-link clickable="true" bind:click="notiToArchive" data-notis="{{notifications}}">
            <view slot="title">
              <view>已归档</view>
            </view>
          </van-cell>
        </van-cell-group>
      </view>
      <!-- 作业 -->
      <view hidden="{{active != 1}}">
        <van-cell-group>
          <view wx:for="{{homeworks}}" wx:key="id" wx:for-item="homework" style="touch-action: none;">
            <block wx:if="{{fn.indexOf(discardHomeworks, homework.id) == -1}}">
              <block wx:if="{{!homework.submitted}}">
                <van-swipe-cell right-width="{{ 60 }}" data-id="{{homework.id}}" bind:click="hwToTap" data-hw="{{homework}}">
                  <view slot="right">
                    <view class="van-swipe-cell__right">归档</view>
                  </view>
                  <van-cell inset use-label-slot="true" clickable="true">
                    <view slot="title">
                      <view>{{homework.title}} <van-tag color="#9932CC" plain>未交</van-tag>
                      </view>
                    </view>
                    <view slot="label">
                      <view class="van-multi-ellipsis--l2">
                        <rich-text nodes="{{homework.content}}"></rich-text>
                      </view>
                    </view>
                  </van-cell>
                </van-swipe-cell>
              </block>
              <block wx:if="{{homework.submitted}}">
                <van-swipe-cell right-width="{{ 60 }}" data-id="{{homework.id}}" bind:click="hwToTap" data-hw="{{homework}}">
                  <view slot="right">
                    <view class="van-swipe-cell__right">归档</view>
                  </view>
                  <van-cell inset use-label-slot="true" clickable="true">
                    <view slot="title">
                      <view> {{homework.title}}</view>
                    </view>
                    <view slot="label">
                      <view class="van-multi-ellipsis--l2">
                        <rich-text nodes="{{homework.description}}"></rich-text>
                      </view>
                    </view>
                  </van-cell>
                </van-swipe-cell>
              </block>
            </block>
          </view>
        </van-cell-group>
      </view>
      <!-- 课程 -->
      <view hidden="{{active != 2}}">
        <van-cell-group>
          <view wx:for="{{courses}}" wx:key="id" wx:for-item="course" style="touch-action: none;">
            <block wx:if="{{fn.indexOf(discardCourses, course.id) == -1}}">
              <van-swipe-cell right-width="{{ 60 }}" bind:click="courseToTap" data-id="{{course.id}}" data-name="{{course.name}}">
                <view slot="right">
                  <view class="van-swipe-cell__right">隐藏</view>
                </view>
                <van-cell inset use-label-slot="true" clickable="true">
                  <view slot="title">
                    <view>{{course.name}}</view>
                  </view>
                  <view slot="label">
                    <view wx:for="{{course.timeAndLocation}}" wx:key="*this" wx:for-item="TAL">
                      <view wx:if="{{TAL != '星期第0节(全周)，'}}">{{TAL}}</view>
                    </view>
                  </view>
                  <view slot="">
                    <view>{{course.teacherName}}</view>
                  </view>
                </van-cell>
              </van-swipe-cell>
            </block>
          </view>
        </van-cell-group>
      </view>
    </van-tab>
  </van-tabs>
</view>