"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.genAlipayUrl = exports.generalGetPayCode = void 0;
const network_1 = require("./network");
const cheerio_1 = __importDefault(require("cheerio"));
const strings_1 = require("../constants/strings");
const generalGetPayCode = async (paymentHtml, encoding) => {
    const $ = cheerio_1.default.load(paymentHtml);
    const url = $("form").attr().action;
    const form = $("[name=biz_content]").attr().value;
    // Get pay code
    return (0, network_1.uFetch)(url + "&biz_content=" + (0, network_1.arbitraryEncode)(form, encoding)).then((s) => {
        const qrCode = (0, cheerio_1.default)("input[name=qrCode]", s).attr().value;
        return qrCode.substring(qrCode.lastIndexOf("/") + 1);
    });
};
exports.generalGetPayCode = generalGetPayCode;
const genAlipayUrl = (payCode) => strings_1.ALIPAY_URL_PREFIX + payCode;
exports.genAlipayUrl = genAlipayUrl;
//# sourceMappingURL=alipay.js.map